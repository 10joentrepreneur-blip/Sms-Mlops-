# ğŸ“± ë©€í‹° í”Œë«í¼ ì—°ë™ ì„¤ê³„ì„œ

## SMS ì£¼ë¬¸ ìë™í™” ì—ì´ì „íŠ¸ - ì±„ë„ í†µí•© ê°€ì´ë“œ

---

## 1. ê°œìš”

### 1.1 ëª©í‘œ
ë‹¤ì–‘í•œ ë©”ì‹œì§• í”Œë«í¼(SMS, ì¹´ì¹´ì˜¤í†¡, ë‹¹ê·¼ë§ˆì¼“, ì¸ìŠ¤íƒ€ê·¸ë¨ DM)ê³¼ ì—°ë™í•˜ì—¬ ì£¼ë¬¸ ìˆ˜ì§‘ ìë™í™” êµ¬ë… ì„œë¹„ìŠ¤ êµ¬í˜„

### 1.2 ì§€ì› ì±„ë„

| ì±„ë„ | ë‚œì´ë„ | ê³µì‹ API | ëŒ€ì•ˆ |
|------|--------|---------|------|
| SMS (iOS/Android) | â­â­â­ | ì œí•œì  | Webhook ì•± |
| ì¹´ì¹´ì˜¤í†¡ | â­â­ | âœ… ìˆìŒ | ì¹´ì¹´ì˜¤ ì±„ë„ |
| ë‹¹ê·¼ë§ˆì¼“ | â­â­â­â­ | âŒ ì—†ìŒ | ì•± ìë™í™” |
| ì¸ìŠ¤íƒ€ê·¸ë¨ DM | â­â­â­ | âœ… ìˆìŒ | Meta API |

---

## 2. SMS ì—°ë™ (iOS/Android)

### 2.1 ë¬¸ì œì 
- iOS/Android ëª¨ë‘ SMS ì ‘ê·¼ì— ëŒ€í•œ ë³´ì•ˆ ì œí•œ
- iOS: ê¸°ë³¸ì ìœ¼ë¡œ SMS ì½ê¸° ë¶ˆê°€
- Android: ê¶Œí•œ í•„ìš”, Play Store ì •ì±… ì œí•œ

### 2.2 í•´ê²° ë°©ì•ˆ

#### ë°©ì•ˆ A: SMS ì „ë‹¬ ì•± (Android) â­ ê¶Œì¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Android Phone â”‚â”€â”€â”€â”€â–¶â”‚  SMS Forwarder  â”‚â”€â”€â”€â”€â–¶â”‚   Our Server    â”‚
â”‚   (SMS ìˆ˜ì‹ )    â”‚     â”‚  App (ìì²´ê°œë°œ)  â”‚     â”‚   (Webhook)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**êµ¬í˜„ ë°©ë²•:**
1. Android ì•± ê°œë°œ (Kotlin/Java)
2. SMS ìˆ˜ì‹  BroadcastReceiver êµ¬í˜„
3. ìˆ˜ì‹ ëœ SMSë¥¼ HTTPë¡œ ì„œë²„ ì „ì†¡

**í•µì‹¬ ì½”ë“œ (Android):**
```kotlin
// AndroidManifest.xml
<uses-permission android:name="android.permission.RECEIVE_SMS"/>
<uses-permission android:name="android.permission.READ_SMS"/>
<uses-permission android:name="android.permission.INTERNET"/>

// SMSReceiver.kt
class SMSReceiver : BroadcastReceiver() {
    override fun onReceive(context: Context, intent: Intent) {
        val bundle = intent.extras
        val pdus = bundle?.get("pdus") as Array<*>?
        
        pdus?.forEach { pdu ->
            val message = SmsMessage.createFromPdu(pdu as ByteArray)
            val sender = message.originatingAddress
            val body = message.messageBody
            
            // ì„œë²„ë¡œ ì „ì†¡
            sendToServer(sender, body)
        }
    }
    
    private fun sendToServer(sender: String, body: String) {
        val client = OkHttpClient()
        val json = JSONObject().apply {
            put("sender", sender)
            put("message", body)
            put("timestamp", System.currentTimeMillis())
        }
        
        val request = Request.Builder()
            .url("https://your-server.com/webhook/sms")
            .post(json.toString().toRequestBody("application/json".toMediaType()))
            .build()
            
        client.newCall(request).enqueue(...)
    }
}
```

#### ë°©ì•ˆ B: Twilio SMS Gateway

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ê³ ê° SMS ë°œì†¡  â”‚â”€â”€â”€â”€â–¶â”‚  Twilio Number  â”‚â”€â”€â”€â”€â–¶â”‚   Our Server    â”‚
â”‚                 â”‚     â”‚  (ê°€ìƒë²ˆí˜¸)      â”‚     â”‚   (Webhook)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¥ì :** 
- ë³„ë„ ì•± ì„¤ì¹˜ ë¶ˆí•„ìš”
- ì•ˆì •ì ì¸ ì¸í”„ë¼

**ë‹¨ì :**
- ë³„ë„ ì „í™”ë²ˆí˜¸ í•„ìš”
- ë¹„ìš© ë°œìƒ (ìˆ˜ì‹ ë‹¹ ~$0.0075)

**êµ¬í˜„:**
```python
# Twilio Webhook Server
from flask import Flask, request
app = Flask(__name__)

@app.route("/webhook/sms", methods=['POST'])
def receive_sms():
    sender = request.form.get('From')
    body = request.form.get('Body')
    
    # ì£¼ë¬¸ ì—ì´ì „íŠ¸ë¡œ ì „ë‹¬
    result = order_agent.parse_order(body)
    
    # ì‘ë‹µ SMS ë°œì†¡
    client.messages.create(
        body=result['confirmation_message'],
        from_=TWILIO_NUMBER,
        to=sender
    )
    return "OK"
```

#### ë°©ì•ˆ C: iOS Shortcuts + iCloud (iOS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   iPhone SMS    â”‚â”€â”€â”€â”€â–¶â”‚  Shortcuts App  â”‚â”€â”€â”€â”€â–¶â”‚   Our Server    â”‚
â”‚   (íŠ¹ì • í‚¤ì›Œë“œ) â”‚     â”‚  (ìë™í™” ì‹¤í–‰)   â”‚     â”‚   (Webhook)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•œê³„:**
- ìˆ˜ë™ íŠ¸ë¦¬ê±° í•„ìš”
- ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ ì œí•œ

---

## 3. ì¹´ì¹´ì˜¤í†¡ ì—°ë™ â­â­ ê¶Œì¥

### 3.1 ì—°ë™ ë°©ì‹

#### ë°©ì•ˆ A: ì¹´ì¹´ì˜¤í†¡ ì±„ë„ + ì±—ë´‡ (ê³µì‹ API) â­â­â­ ê¶Œì¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ê³ ê°          â”‚â”€â”€â”€â”€â–¶â”‚  ì¹´ì¹´ì˜¤í†¡ ì±„ë„   â”‚â”€â”€â”€â”€â–¶â”‚   ì±—ë´‡ ì„œë²„     â”‚
â”‚   (ë©”ì‹œì§€ ì „ì†¡) â”‚     â”‚  (ë¹„ì¦ˆë‹ˆìŠ¤)      â”‚     â”‚   (Webhook)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚  ì£¼ë¬¸ ì—ì´ì „íŠ¸   â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•„ìš” ì¡°ê±´:**
1. ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ ê³„ì •
2. ì¹´ì¹´ì˜¤í†¡ ì±„ë„ ê°œì„¤
3. ì±—ë´‡ ì—°ë™ ì„¤ì •

**êµ¬í˜„ ë‹¨ê³„:**

**Step 1: ì¹´ì¹´ì˜¤ ì±„ë„ ìƒì„±**
```
1. https://business.kakao.com ì ‘ì†
2. ì¹´ì¹´ì˜¤í†¡ ì±„ë„ ë§Œë“¤ê¸°
3. ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì¦ (ì‚¬ì—…ìë“±ë¡ì¦)
4. ì±„ë„ í”„ë¡œí•„ ì„¤ì •
```

**Step 2: ì±—ë´‡ ì„œë²„ êµ¬í˜„**
```python
from flask import Flask, request, jsonify
import requests

app = Flask(__name__)

# ì¹´ì¹´ì˜¤ ì±—ë´‡ Webhook
@app.route("/kakao/webhook", methods=['POST'])
def kakao_webhook():
    data = request.json
    user_id = data['userRequest']['user']['id']
    message = data['userRequest']['utterance']
    
    # ë©”ì‹œì§€ ìœ í˜• ë¶„ë¥˜
    intent = classify_intent(message)
    
    if intent == "order":
        # ì£¼ë¬¸ ì²˜ë¦¬
        result = order_agent.parse_order(message)
        response_text = generate_confirmation(result)
    elif intent == "guide_request":
        # íŒë§¤ì ê°€ì´ë“œ ë°œì†¡
        response_text = get_seller_guide()
    else:
        response_text = "ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?"
    
    # ì¹´ì¹´ì˜¤ ì‘ë‹µ í¬ë§·
    return jsonify({
        "version": "2.0",
        "template": {
            "outputs": [{
                "simpleText": {
                    "text": response_text
                }
            }]
        }
    })

# ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ ë°œì†¡ (íŒë§¤ì â†’ ê³ ê°)
def send_alimtalk(phone, template_code, variables):
    url = "https://kapi.kakao.com/v2/api/talk/memo/default/send"
    headers = {
        "Authorization": f"Bearer {KAKAO_ACCESS_TOKEN}",
        "Content-Type": "application/x-www-form-urlencoded"
    }
    
    template = {
        "object_type": "text",
        "text": format_template(template_code, variables),
        "link": {"web_url": "https://your-service.com"}
    }
    
    requests.post(url, headers=headers, data={"template_object": json.dumps(template)})
```

**Step 3: ì±—ë´‡ ì‹œë‚˜ë¦¬ì˜¤ ì„¤ê³„**
```yaml
# ì±—ë´‡ ì‹œë‚˜ë¦¬ì˜¤
scenarios:
  - name: "ì£¼ë¬¸ ì ‘ìˆ˜"
    triggers:
      - "ì£¼ë¬¸í•©ë‹ˆë‹¤"
      - "ì£¼ë¬¸í• ê²Œìš”"
      - "êµ¬ë§¤"
    actions:
      - parse_order
      - validate
      - send_confirmation
  
  - name: "ê°€ì´ë“œ ìš”ì²­"
    triggers:
      - "ìƒí’ˆ ëª©ë¡"
      - "ê°€ê²©í‘œ"
      - "ì£¼ë¬¸ë°©ë²•"
    actions:
      - send_seller_guide
  
  - name: "ë°°ì†¡ ì¡°íšŒ"
    triggers:
      - "ë°°ì†¡ ì–´ë””"
      - "ì–¸ì œ ì™€ìš”"
    actions:
      - lookup_delivery
      - send_tracking
```

### 3.2 ì•Œë¦¼í†¡ í™œìš©

```python
# ì£¼ë¬¸ í™•ì¸ ì•Œë¦¼í†¡
ORDER_CONFIRM_TEMPLATE = """
[ì£¼ë¬¸ í™•ì¸]

ì•ˆë…•í•˜ì„¸ìš”, {customer_name}ë‹˜!
ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.

â–  ì£¼ë¬¸ë‚´ì—­
{order_items}

â–  ê²°ì œê¸ˆì•¡: {total_amount}ì›
â–  ì…ê¸ˆê³„ì¢Œ: {bank_account}

ì…ê¸ˆ í™•ì¸ í›„ ë°œì†¡ ì˜ˆì •ì…ë‹ˆë‹¤.
ê°ì‚¬í•©ë‹ˆë‹¤!
"""

# ë°œì†¡ ì•Œë¦¼í†¡
SHIPPING_TEMPLATE = """
[ë°œì†¡ ì•ˆë‚´]

{customer_name}ë‹˜, ìƒí’ˆì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!

â–  ìš´ì†¡ì¥: {tracking_number}
â–  íƒë°°ì‚¬: {courier}

ë°°ì†¡ì¡°íšŒ: {tracking_url}
"""
```

---

## 4. ë‹¹ê·¼ë§ˆì¼“ ì—°ë™ â­â­â­â­ (ê³ ë‚œì´ë„)

### 4.1 ë¬¸ì œì 
- **ê³µì‹ API ì—†ìŒ** (2025ë…„ ê¸°ì¤€)
- ì›¹ ìŠ¤í¬ë˜í•‘ ì°¨ë‹¨
- ìë™í™” ì •ì±… ìœ„ë°˜ ìš°ë ¤

### 4.2 í•´ê²° ë°©ì•ˆ

#### ë°©ì•ˆ A: ë‹¹ê·¼ ë¹„ì¦ˆí”„ë¡œí•„ + ìˆ˜ë™ ì—°ë™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ë‹¹ê·¼ ì±„íŒ…     â”‚â”€â”€â”€â”€â–¶â”‚  íŒë§¤ì ìˆ˜ë™    â”‚â”€â”€â”€â”€â–¶â”‚   ì—ì´ì „íŠ¸ ì›¹   â”‚
â”‚   (ë©”ì‹œì§€ ìˆ˜ì‹ ) â”‚     â”‚  ë³µì‚¬/ë¶™ì—¬ë„£ê¸°  â”‚     â”‚   (íŒŒì‹± ì²˜ë¦¬)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**êµ¬í˜„:**
```html
<!-- ì›¹ ì¸í„°í˜ì´ìŠ¤ -->
<div class="order-input">
    <h3>ë‹¹ê·¼ ì±„íŒ… ë©”ì‹œì§€ ë¶™ì—¬ë„£ê¸°</h3>
    <textarea id="carrot-message" placeholder="ë‹¹ê·¼ ì±„íŒ… ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
    <button onclick="parseCarrotOrder()">ì£¼ë¬¸ íŒŒì‹±</button>
</div>

<script>
async function parseCarrotOrder() {
    const message = document.getElementById('carrot-message').value;
    const response = await fetch('/api/parse/order', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({order_text: message, channel: 'carrot'})
    });
    const result = await response.json();
    displayResult(result);
}
</script>
```

#### ë°©ì•ˆ B: Android ìë™í™” (Tasker + AutoInput)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ë‹¹ê·¼ ì•±       â”‚â”€â”€â”€â”€â–¶â”‚  Tasker ìë™í™”  â”‚â”€â”€â”€â”€â–¶â”‚   Our Server    â”‚
â”‚   (ì•Œë¦¼ ê°ì§€)   â”‚     â”‚  (í…ìŠ¤íŠ¸ ì¶”ì¶œ)  â”‚     â”‚   (Webhook)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Tasker ì„¤ì •:**
```
Profile: ë‹¹ê·¼ ë©”ì‹œì§€ ì•Œë¦¼
    Event: Notification
    App: ë‹¹ê·¼ë§ˆì¼“
    
Task: ë©”ì‹œì§€ ì „ë‹¬
    A1: AutoInput UI Query
        Action: Text
        Check Screen State: true
    A2: HTTP Request
        Method: POST
        URL: https://your-server.com/webhook/carrot
        Body: %aitext
```

**ì£¼ì˜ì‚¬í•­:**
- Android ì „ìš©
- ì ‘ê·¼ì„± ê¶Œí•œ í•„ìš”
- ë‹¹ê·¼ ì•½ê´€ ê²€í†  í•„ìš”

#### ë°©ì•ˆ C: ë‹¹ê·¼ ë¹„ì¦ˆí”„ë¡œí•„ API (í–¥í›„)
- ë‹¹ê·¼ì—ì„œ ë¹„ì¦ˆí”„ë¡œí•„ API ì¶œì‹œ ì˜ˆì • (ë¯¸í™•ì •)
- ì¶œì‹œ ì‹œ ê³µì‹ ì—°ë™ìœ¼ë¡œ ì „í™˜

---

## 5. ì¸ìŠ¤íƒ€ê·¸ë¨ DM ì—°ë™

### 5.1 ì—°ë™ ë°©ì‹

#### Meta Messenger API (ê³µì‹)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Instagram DM  â”‚â”€â”€â”€â”€â–¶â”‚  Meta Webhook   â”‚â”€â”€â”€â”€â–¶â”‚   Our Server    â”‚
â”‚   (ë©”ì‹œì§€ ìˆ˜ì‹ ) â”‚     â”‚  (Graph API)    â”‚     â”‚   (ì²˜ë¦¬)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•„ìš” ì¡°ê±´:**
1. Instagram ë¹„ì¦ˆë‹ˆìŠ¤/í¬ë¦¬ì—ì´í„° ê³„ì •
2. Facebook í˜ì´ì§€ ì—°ê²°
3. Meta ì•± ìƒì„± ë° ê¶Œí•œ ìŠ¹ì¸

**êµ¬í˜„ ë‹¨ê³„:**

**Step 1: Meta ì•± ì„¤ì •**
```
1. https://developers.facebook.com
2. ì•± ìƒì„± â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ìœ í˜•
3. Instagram API ì¶”ê°€
4. Webhook ì„¤ì •
5. ê¶Œí•œ ìš”ì²­: instagram_manage_messages
```

**Step 2: Webhook êµ¬í˜„**
```python
from flask import Flask, request
import requests

app = Flask(__name__)

# Webhook ê²€ì¦
@app.route("/instagram/webhook", methods=['GET'])
def verify_webhook():
    mode = request.args.get('hub.mode')
    token = request.args.get('hub.verify_token')
    challenge = request.args.get('hub.challenge')
    
    if mode == 'subscribe' and token == VERIFY_TOKEN:
        return challenge
    return "Forbidden", 403

# ë©”ì‹œì§€ ìˆ˜ì‹ 
@app.route("/instagram/webhook", methods=['POST'])
def receive_message():
    data = request.json
    
    for entry in data.get('entry', []):
        for messaging in entry.get('messaging', []):
            sender_id = messaging['sender']['id']
            message = messaging.get('message', {}).get('text', '')
            
            if message:
                # ì£¼ë¬¸ ì²˜ë¦¬
                result = order_agent.parse_order(message)
                
                # DM ì‘ë‹µ
                send_instagram_reply(sender_id, result['confirmation'])
    
    return "OK"

def send_instagram_reply(recipient_id, message):
    url = f"https://graph.facebook.com/v18.0/me/messages"
    headers = {"Authorization": f"Bearer {PAGE_ACCESS_TOKEN}"}
    data = {
        "recipient": {"id": recipient_id},
        "message": {"text": message}
    }
    requests.post(url, headers=headers, json=data)
```

**Step 3: ê¶Œí•œ ìŠ¹ì¸ ì ˆì°¨**
```
1. ì•± ì‹¬ì‚¬ ìš”ì²­ (Meta)
2. instagram_manage_messages ê¶Œí•œ ìŠ¹ì¸
3. ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì¦
4. ë¼ì´ë¸Œ ëª¨ë“œ ì „í™˜
```

---

## 6. í†µí•© ì•„í‚¤í…ì²˜

### 6.1 ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚        Message Gateway Layer         â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          â”‚          â”‚          â”‚          â”‚          â”‚
        â–¼          â–¼          â–¼          â–¼          â–¼          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   SMS   â”‚â”‚  Kakao  â”‚â”‚  Carrot â”‚â”‚Instagramâ”‚â”‚  Web    â”‚â”‚  API    â”‚
   â”‚ Gateway â”‚â”‚ Channel â”‚â”‚ (Manual)â”‚â”‚   DM    â”‚â”‚  Form   â”‚â”‚ Direct  â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚          â”‚          â”‚          â”‚          â”‚          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚     Message Queue (Redis)      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚       Order Processing        â”‚
                         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
                         â”‚   â”‚   SMS Order Agent   â”‚     â”‚
                         â”‚   â”‚  (Parse + Validate) â”‚     â”‚
                         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                    â”‚                    â”‚
                    â–¼                    â–¼                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Order DB  â”‚      â”‚ Customer DB â”‚      â”‚  Guide DB   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                    â”‚                    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚      Response Generator       â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          â”‚          â”‚          â”‚          â”‚          â”‚
        â–¼          â–¼          â–¼          â–¼          â–¼          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   SMS   â”‚â”‚  Kakao  â”‚â”‚  Carrot â”‚â”‚Instagramâ”‚â”‚  Push   â”‚â”‚  Email  â”‚
   â”‚  Reply  â”‚â”‚ Alimtok â”‚â”‚ (Manual)â”‚â”‚  Reply  â”‚â”‚ Notify  â”‚â”‚ Notify  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 í†µí•© API ì„¤ê³„

```python
# í†µí•© ë©”ì‹œì§€ ìˆ˜ì‹  API
@app.route("/api/v1/message/receive", methods=['POST'])
def receive_message():
    """
    ëª¨ë“  ì±„ë„ì˜ ë©”ì‹œì§€ë¥¼ í†µí•© ì²˜ë¦¬
    """
    data = request.json
    
    # í•„ìˆ˜ í•„ë“œ
    channel = data['channel']  # sms, kakao, carrot, instagram, web
    sender = data['sender']     # ë°œì‹ ì ID/ë²ˆí˜¸
    message = data['message']   # ë©”ì‹œì§€ ë‚´ìš©
    
    # ì„ íƒ í•„ë“œ
    seller_id = data.get('seller_id')  # íŒë§¤ì ID
    attachments = data.get('attachments', [])  # ì´ë¯¸ì§€ ë“±
    
    # ë©”ì‹œì§€ íì— ì¶”ê°€
    task_id = queue.enqueue(
        process_message,
        channel=channel,
        sender=sender,
        message=message,
        seller_id=seller_id
    )
    
    return jsonify({
        "status": "queued",
        "task_id": task_id
    })
```

---

## 7. êµ¬í˜„ ë¡œë“œë§µ

### Phase 1: ê¸°ë³¸ ì¸í”„ë¼ (2ì£¼)
- [ ] í†µí•© API ì„œë²„ êµ¬ì¶•
- [ ] ë©”ì‹œì§€ í ì„¤ì •
- [ ] ê¸°ë³¸ DB ìŠ¤í‚¤ë§ˆ

### Phase 2: ì¹´ì¹´ì˜¤í†¡ ì—°ë™ (2ì£¼)
- [ ] ì¹´ì¹´ì˜¤ ì±„ë„ ê°œì„¤
- [ ] ì±—ë´‡ Webhook êµ¬í˜„
- [ ] ì•Œë¦¼í†¡ í…œí”Œë¦¿ ë“±ë¡

### Phase 3: SMS ì—°ë™ (2ì£¼)
- [ ] Android SMS ì „ë‹¬ ì•± ê°œë°œ
- [ ] Twilio ë°±ì—… ì„¤ì •
- [ ] ì‘ë‹µ SMS ë°œì†¡

### Phase 4: ì¸ìŠ¤íƒ€ê·¸ë¨ ì—°ë™ (2ì£¼)
- [ ] Meta ì•± ë“±ë¡
- [ ] ê¶Œí•œ ìŠ¹ì¸ ì ˆì°¨
- [ ] DM Webhook êµ¬í˜„

### Phase 5: ë‹¹ê·¼ë§ˆì¼“ ì—°ë™ (2ì£¼)
- [ ] ìˆ˜ë™ ì—°ë™ ì›¹ UI
- [ ] (ì˜µì…˜) Android ìë™í™”

### Phase 6: í†µí•© í…ŒìŠ¤íŠ¸ (1ì£¼)
- [ ] E2E í…ŒìŠ¤íŠ¸
- [ ] ë¶€í•˜ í…ŒìŠ¤íŠ¸
- [ ] ë°°í¬

---

## 8. ë¹„ìš© ì¶”ì •

| í•­ëª© | ì›” ì˜ˆìƒ ë¹„ìš© |
|------|-------------|
| ì„œë²„ (AWS/GCP) | $50-100 |
| ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ | $0.008/ê±´ Ã— ê±´ìˆ˜ |
| Twilio SMS | $0.0075/ê±´ Ã— ê±´ìˆ˜ |
| ì¸ìŠ¤íƒ€ API | ë¬´ë£Œ |
| **ì´ (1,000ê±´/ì›” ê¸°ì¤€)** | **~$70** |

---

**ì‘ì„±ì¼**: 2025-12-22  
**ë²„ì „**: 1.0.0
