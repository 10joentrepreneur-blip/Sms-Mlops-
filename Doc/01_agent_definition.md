# 📱 SMS 문자 주문 자동화 에이전트 정의서

## 1. 프로젝트 개요

### 1.1 프로젝트명
**SMS Order Automation Agent (SOAA)**

### 1.2 프로젝트 목적
카카오톡, 문자메시지 등 메시징 플랫폼을 통해 수신되는 비정형 주문 메시지를 자동으로 파싱하여 구조화된 데이터로 변환하고, 주문 확인/응답 메시지를 자동 생성하는 AI 에이전트 개발

### 1.3 대상 사용자
- **판매자**: 소상공인, 공동구매 운영자, SNS 판매자
- **구매자**: 문자/카카오톡으로 주문하는 일반 고객

### 1.4 핵심 가치 제안
| 기존 방식 | 자동화 후 |
|----------|----------|
| 주문 1건당 3-5분 수작업 | 즉시 자동 처리 |
| 오입력/누락 발생 | 99%+ 정확도 |
| 1일 50건 한계 | 1일 1,000건+ 처리 |
| 응답 지연 | 실시간 자동 응답 |

---

## 2. 시스템 아키텍처

### 2.1 전체 구성도

```
┌─────────────────────────────────────────────────────────────────┐
│                        메시지 수신 채널                           │
├──────────┬──────────┬──────────┬──────────┬─────────────────────┤
│   SMS    │ 카카오톡  │   당근    │ 인스타DM │      기타 채널       │
└────┬─────┴────┬─────┴────┬─────┴────┬─────┴──────────┬──────────┘
     │          │          │          │                │
     ▼          ▼          ▼          ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    메시지 수집 게이트웨이                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │ SMS Gateway │  │ Kakao API   │  │ Platform Connectors     │  │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘  │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                     주문 처리 에이전트                           │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                   1. 메시지 분류기                        │    │
│  │     주문 / 문의 / 취소 / 변경 / 기타 자동 분류              │    │
│  └───────────────────────────┬─────────────────────────────┘    │
│                              │                                   │
│  ┌───────────────────────────▼─────────────────────────────┐    │
│  │                   2. 정보 추출 엔진                       │    │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────────┐    │    │
│  │  │ 고객명  │ │ 연락처  │ │  주소   │ │ 상품/수량   │    │    │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────────┘    │    │
│  └───────────────────────────┬─────────────────────────────┘    │
│                              │                                   │
│  ┌───────────────────────────▼─────────────────────────────┐    │
│  │                   3. 검증 및 보정                         │    │
│  │     주소 정규화 / 전화번호 검증 / 상품 매칭                  │    │
│  └───────────────────────────┬─────────────────────────────┘    │
│                              │                                   │
│  ┌───────────────────────────▼─────────────────────────────┐    │
│  │                   4. 응답 생성기                          │    │
│  │     주문확인 / 정보요청 / 배송안내 메시지 자동 생성          │    │
│  └─────────────────────────────────────────────────────────┘    │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                      데이터 저장소                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │ 주문 DB     │  │ 고객 DB     │  │ 판매자 가이드 DB        │  │
│  │ (Orders)   │  │ (Customers) │  │ (Seller Guides)        │  │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘  │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                      출력 및 연동                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │ Excel 내보내기│  │ 자동 응답   │  │ ERP/POS 연동           │  │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 핵심 컴포넌트

| 컴포넌트 | 역할 | 기술 스택 |
|---------|------|----------|
| Message Gateway | 다채널 메시지 수집 | Twilio, Kakao API, Webhook |
| NLP Parser | 비정형 텍스트 파싱 | Regex + LLM (Claude/GPT) |
| Validator | 데이터 검증/보정 | Python, 주소DB API |
| Response Generator | 응답 메시지 생성 | Template + LLM |
| Data Store | 주문/고객 데이터 관리 | PostgreSQL, Redis |
| Export Module | Excel/ERP 연동 | openpyxl, API Client |

---

## 3. 기능 명세

### 3.1 핵심 기능 (MVP)

#### F1. 판매자 가이드 파싱
```
입력: 판매자 가이드 텍스트
출력: 구조화된 상품 목록, 가격, 계좌 정보
```

**추출 항목:**
- 판매자명
- 상품 목록 (번호, 이름, 가격, 옵션)
- 결제 계좌 정보
- 배송 정책 (무료배송 기준, 배송비)
- 주문 마감일

#### F2. 주문 메시지 파싱
```
입력: 비정형 주문 텍스트
출력: 구조화된 주문 데이터 (JSON)
```

**추출 항목:**
- 고객명
- 연락처 (정규화)
- 배송지 주소
- 주문 상품 (상품번호, 옵션, 수량)
- 요청사항
- 입금자명
- 희망 배송일

#### F3. 주문 검증
```
입력: 파싱된 주문 데이터
출력: 검증 결과 (유효/무효, 누락 필드, 경고)
```

**검증 항목:**
- 필수 필드 존재 여부
- 연락처 형식 검증
- 주소 형식 검증
- 상품 존재 여부 확인
- 금액 계산 검증

#### F4. 자동 응답 생성
```
입력: 주문 데이터 + 검증 결과
출력: 응답 메시지 텍스트
```

**응답 유형:**
- 주문 확인 메시지
- 정보 요청 메시지 (누락 시)
- 발송 알림 메시지
- 문의 응답 메시지

### 3.2 확장 기능

| 기능 | 설명 | 우선순위 |
|------|------|---------|
| OCR 입금 확인 | 송금 캡처 이미지 자동 인식 | P1 |
| 멀티턴 대화 | 누락 정보 자동 질문/수집 | P1 |
| 재주문 추천 | 과거 주문 기반 추천 | P2 |
| 배송 추적 연동 | 운송장 자동 조회 | P2 |
| 통계 대시보드 | 매출/주문 현황 시각화 | P2 |

---

## 4. 데이터 모델

### 4.1 주문 데이터 스키마

```json
{
  "order_id": "ORD20251222001",
  "channel": "kakao",
  "raw_message": "주문합니다...",
  "parsed_at": "2025-12-22T15:30:00Z",
  
  "customer": {
    "name": "김철수",
    "phone": "010-1234-5678",
    "address": "서울시 강남구..."
  },
  
  "items": [
    {
      "product_code": "1",
      "product_name": "수분크림 50ml",
      "option": "21호",
      "unit": "개",
      "unit_price": 32000,
      "quantity": 2,
      "subtotal": 64000
    }
  ],
  
  "payment": {
    "subtotal": 64000,
    "shipping_fee": 0,
    "total": 64000,
    "payer_name": "김철수",
    "status": "pending"
  },
  
  "delivery": {
    "requested_date": "2025-12-24",
    "special_requests": "문앞에 놔주세요",
    "tracking_number": null,
    "status": "pending"
  },
  
  "metadata": {
    "confidence_score": 0.95,
    "parse_errors": [],
    "seller_guide_id": "SG001"
  }
}
```

### 4.2 판매자 가이드 스키마

```json
{
  "guide_id": "SG001",
  "seller_name": "뷰티하우스",
  "created_at": "2025-12-20",
  
  "products": {
    "1": {
      "name": "수분크림 50ml",
      "price": 32000,
      "unit": "개",
      "options": []
    },
    "2": {
      "name": "쿠션팩트",
      "price": 35000,
      "unit": "개",
      "options": ["21호", "23호"]
    }
  },
  
  "payment": {
    "bank": "국민",
    "account": "123-456-789012",
    "holder": "뷰티하우스"
  },
  
  "shipping": {
    "free_threshold": 50000,
    "fee": 3000
  }
}
```

---

## 5. API 명세

### 5.1 REST API

#### POST /api/v1/parse/guide
판매자 가이드 파싱

```bash
curl -X POST /api/v1/parse/guide \
  -H "Content-Type: application/json" \
  -d '{"guide_text": "뷰티하우스에서..."}'
```

#### POST /api/v1/parse/order
주문 메시지 파싱

```bash
curl -X POST /api/v1/parse/order \
  -H "Content-Type: application/json" \
  -d '{
    "guide_id": "SG001",
    "order_text": "주문합니다..."
  }'
```

#### POST /api/v1/validate
주문 검증

#### POST /api/v1/response/generate
응답 메시지 생성

### 5.2 Webhook API

```
POST /webhook/kakao    # 카카오톡 메시지 수신
POST /webhook/sms      # SMS 메시지 수신
POST /webhook/carrot   # 당근마켓 메시지 수신
POST /webhook/instagram # 인스타그램 DM 수신
```

---

## 6. 기술 요구사항

### 6.1 성능 요구사항

| 지표 | 목표값 |
|------|--------|
| 파싱 정확도 | 95% 이상 |
| 응답 시간 | 3초 이내 |
| 처리량 | 100건/분 |
| 가용성 | 99.5% |

### 6.2 기술 스택

**Backend:**
- Python 3.11+
- FastAPI
- PostgreSQL
- Redis

**AI/ML:**
- Claude API / GPT-4 API
- Regex 기반 파서
- OCR (Google Vision / Tesseract)

**Infrastructure:**
- Docker / Kubernetes
- AWS / GCP
- GitHub Actions (CI/CD)

---

## 7. 보안 요구사항

### 7.1 개인정보 보호
- 고객 개인정보 암호화 저장
- 전송 구간 TLS 적용
- 접근 로그 기록
- 30일 이상 미사용 데이터 자동 삭제

### 7.2 인증/인가
- API Key 기반 인증
- Rate Limiting (100 req/min)
- IP Whitelist 옵션

---

## 8. 프로젝트 일정

### Phase 1: MVP (4주)
- Week 1-2: 핵심 파싱 엔진 개발
- Week 3: API 서버 개발
- Week 4: 테스트 및 배포

### Phase 2: 채널 연동 (4주)
- Week 5-6: 카카오톡 연동
- Week 7-8: SMS 게이트웨이 연동

### Phase 3: 고도화 (4주)
- Week 9-10: LLM 기반 파싱 개선
- Week 11-12: OCR 입금 확인 기능

---

## 9. 버전 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 1.0.0 | 2025-12-22 | 초기 버전 |

---

**작성일**: 2025-12-22  
**작성자**: SMS Order Agent Team
